resources:
  - ../../base
namespace: three-tier-application

nameSuffix: -production

images:
  - name: ghcr.io/sysadmin29/back-end
    newTag: v1.0.3

# replicas:
#   - name: backend
#     count: 1

labels:
  - includeSelectors: true
    includeTemplates: true
    pairs:
      app.kubernetes.io/part-of: "backend"

configMapGenerator:
  - name: backend-config
    env: config.properties

secretGenerator:
  - name: backend-secrets
    env: secrets.properties

patches:
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: backend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/envFrom/1/secretRef/name
        value: backend-secrets-production
  - target:
      group: networking.k8s.io
      version: v1
      kind: Ingress
      name: backend-ingress
    patch: |-
      - op: replace
        path: /spec/tls/0/hosts/0
        value: backend.aura.local
      - op: replace
        path: /spec/tls/0/secretName
        value: backend-tls
      - op: replace
        path: /spec/rules/0/host
        value: backend.aura.local
